<html xmlns="http://www.w3.org/1999/xhtml"><head><title>XProc FAQ</title><meta charset="utf-8" /><meta name="generator" content="DocBook XSL 2.0 Stylesheets V2.0.20" /><link rel="stylesheet" type="text/css" href="https://docbook.github.io/release/2.0.20/resources/css/default.css" /><link rel="stylesheet" type="text/css" href="/css/docbook.css" /><link rel="stylesheet" type="text/css" href="/css/tabs.css" /><link rel="stylesheet" type="text/css" href="/css/website.css" /><link rel="icon" href="/graphics/icon.ico" type="image/ico" /><script type="text/javascript" src="https://docbook.github.io/release/2.0.20/resources/js/dbmodnizr.js"></script><link href="https://docbook.github.io/release/2.0.20/resources/css/prism.css" rel="stylesheet" type="text/css" /><link href="https://docbook.github.io/release/2.0.20/resources/css/db-prism.css" rel="stylesheet" type="text/css" /></head><body><div class="header">
<h1><img src="/images/xproc.png" alt="XML Processing" /></h1>
</div><div class="navset" id="nav"><div class="hd"><ul><li id="home" class="on" title="selected"><a href="/"><strong><em>Home</em></strong></a></li><li id="impl"><a href="/implementations/"><em>Implementations</em></a></li><li id="library"><a href="/library/"><em>Library</em></a></li><li id="extensions"><a href="/extensions/"><em>Extensions</em></a></li></ul></div><div class="bd"><ul><li class=" first "><a href="/">Overview</a></li><li id="background" class="  "><a href="/background/">Background</a></li><li id="faq" class="on  "><a href="/faq/">FAQ</a></li><li id="contact" class="  last"><a href="/contact/">Contact us</a></li><li>«<a href="https://www.oxygenxml.com/webapp-demo-aws/app/oxygen.html?url=github://getFileContent/xproc/xproc.org/master/faq/index.xml" title="Courtesy of oXygen XML Web Author">Edit this page on GitHub</a>»</li></ul></div></div><article class="article"><h1>XProc FAQ</h1><p>This page summarizes some of the Frequently Asked Questions about
XProc. Feel free to <a href="/contact/">send more</a> (with
answers, if you can :-).</p><section id="string-replace" class="section"><div class="section-titlepage"><h2>Why doesn't <code class="tag-element">p:string-replace</code> work?</h2></div><p>Why does <code class="tag-element">p:string-replace</code> report an XPath exception when
I try to use a variable in the replacement text?</p><pre class="programlisting language-none"><code>&lt;p:variable name="value" select="/some/expression"/&gt;

&lt;p:string-replace match="//target" replace="concat('X-',$value)"/&gt;</code></pre><p>XProc <em>steps</em>
<a href="http://www.w3.org/TR/xproc/#step-xpath-context-10">don't
have access</a> to the options or variables defined in your pipeline (nor
do they have access to XPath extension functions defined by XProc).</p><p>If you want to use the value of a variable, or an XPath extension function,
in the computed value of your step, you must let the XProc processor compute
the value:</p><pre class="programlisting language-none"><code>&lt;p:variable name="value" select="/some/expression"/&gt;

&lt;p:string-replace match="//target"&gt;
  &lt;p:with-option name="replace" select="concat('&amp;quot;X-',$value,'&amp;quot;')"/&gt;
&lt;/p:string-replace&gt;</code></pre><p>Why does <code class="tag-element">p:string-replace</code> report an XPath exception when
I pass a computed expression in the replacement text?</p><pre class="programlisting language-none"><code>&lt;p:string-replace match="//target"&gt;
  &lt;p:with-option name="replace" select="p:base-uri()"/&gt;
&lt;/p:string-replace&gt;</code></pre><p>The <code class="tag-element">p:string-replace</code> step evaluates the <em>value</em>
of the <code class="option">replace</code> option <em>as an XPath expression</em>.
</p><p>In the example above, when <code class="tag-element">p:string-replace</code> matches a
<code class="literal">//target</code>, it attempts to evaluate the value of the base URI as
an XPath expression and that's (not likely to be) a syntactically correct
expression.</p><p>When you pass a computed value to <code class="tag-element">p:string-replace</code>, you
almost always want to explicitly add quotes to the computed value so that
when it's evaluated by the step, it's simply a string literal:</p><pre class="programlisting language-none"><code>&lt;p:string-replace match="//target"&gt;
  &lt;p:with-option name="replace" select="concat('&amp;quot;',p:base-uri(),'&amp;quot;')"/&gt;
&lt;/p:string-replace&gt;</code></pre></section><footer>Last updated on 30 Sep 2016 at 07:35p.m. GMT-05:00 by Norman Walsh</footer></article><script src="https://docbook.github.io/release/2.0.20/resources/js/prism.js"></script></body></html>